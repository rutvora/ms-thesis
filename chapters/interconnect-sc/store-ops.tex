\section{Generating contention via CPU instructions}
\label{sec:interconnect-sc-store-ops}

There are two primary ways one can generate traffic on the PCIe link.
1) CPU \textit{load} or \textit{store} instructions on memory-mapped PCIe configuration, device memory, or I/O address space, and 
2) direct memory access (DMA) to copy data between the PCIe device memory and the DRAM.
We now discuss how to use CPU instructions to generate the traffic and defer the discussion of generating traffic via DMA to \Cref{sec:interconnect-sc-dma}.
We also answer \textbf{RQ1}, ``Is it possible to create contention in PCIe links without the adversary saturating the PCIe bandwidth?''.

An adversary can generate traffic from the CPU by mapping a PCIe device resource to an application running on the CPU and issuing load or store operations on the mapped memory.
Each load/store operation will be buffered in the PCIe controller until a transaction layer packet (TLP) is generated and ready to be transmitted.
Two factors influence the actual transmission time of the packet:
1) The ordering of the packets, as outlined in \Cref{tab:pcie-transaction-ordering-rules}, and
2) The number of pending packets in the PCIe controller buffer that are not subject to any ordering rules relative to the current packet.
Suppose the packets do not have any relative ordering rule. 
In that case, the ordering of the packets is solely dependent on the scheduling algorithm of the PCIe controller and can not be influenced by the attacker.
As such, any packet generated by the adversary can be delayed due to existing traffic in the buffer based on the controller's scheduling policy and the ordering rules.
If there is no traffic in the buffer, the adversary's packets will not be delayed.
As a result, the attacker can detect the presence or absence of victim traffic without saturating PCIe bandwidth if the PCIe controller schedules packets that do not have any ordering constraints using a first-in-first-out (FIFO) or similar policy.
If the packets do have relative ordering rules, the scheduler will follow those ordering rules, and either the attacker's or the victim's traffic might be delayed based on the transactions issued by them.

To observe the victim traffic, the attacker should ensure they have a packet pending in the PCIe controller as frequently as possible.
This ensures that the attacker can observe the presence or absence of victim traffic at a fine granularity.
The attacker also needs to ensure that the packet would not be delayed because of their traffic.
To achieve these goals, the attacker must determine the correct combination of the PCIe resource and instruction, as different instructions on different resources can lead to different PCIe transactions and transaction ordering rules.


\input{chapters/interconnect-sc/store-ops/challenges}
\input{chapters/interconnect-sc/store-ops/measuring-store-time}
% \input{chapters/interconnect-sc/store-ops/evaluation}
